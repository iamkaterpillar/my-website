<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Page Not Found</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script>
    // List of valid static pages
    const staticPages = ['about', 'blog', 'bebop'];
    
    // Get the path without leading/trailing slashes
    const path = window.location.pathname.replace(/^\/+|\/+$/g, '');
    
    // Function to check if a path is a blog post
    async function checkIfBlogPost(path) {
      try {
        const response = await fetch('/data/posts.json');
        const posts = await response.json();
        return posts.find(post => post.slug === path);
      } catch (error) {
        console.error('Error checking blog post:', error);
        return false;
      }
    }

    // Handle routing
    async function handleRouting() {
      // If it's a known static page without .html extension
      if (staticPages.includes(path)) {
        window.location.replace('/pages/' + path + '.html');
        return;
      }
      
      // If it's already a .html page in pages directory
      if (path.startsWith('pages/') && path.endsWith('.html')) {
        // This is a direct HTML page access, let it 404 naturally
        return;
      }
      
      // Check if it's a blog post
      const post = await checkIfBlogPost(path);
      if (post) {
        // If it's a blog post, load the post template
        const postTemplate = await fetch('/pages/post.html').then(res => res.text());
        document.documentElement.innerHTML = postTemplate;
        
        // Initialize the post content
        window.addEventListener('layoutLoaded', () => {
          const postContent = document.getElementById('postContent');
          if (postContent) {
            fetch(`/posts/${post.id}/index.html`)
              .then(res => res.text())
              .then(html => {
                postContent.innerHTML = html;
              })
              .catch(error => {
                console.error('Error loading post content:', error);
                postContent.innerHTML = '<p>Could not load post content.</p>';
              });
          }
        });
        return;
      }
      
      // If it's not a known page, redirect to home
      window.location.replace('/');
    }

    // Start routing
    handleRouting();
  </script>
</head>
<body>
  <main>
    <h1>Page Not Found</h1>
    <p>Redirecting you to the right place...</p>
  </main>
</body>
</html> 